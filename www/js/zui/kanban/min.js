/*!
 * ZUI: ZUI Kanban View - v1.10.0 - 2021-11-30
 * http://openzui.com
 * GitHub: https://github.com/easysoft/zui.git 
 * Copyright (c) 2021 cnezsoft.com; Licensed MIT
 */
!function(){"use strict";function a(a,n){return e&&!n?requestAnimationFrame(a):setTimeout(a,n||0)}function n(a){return e?cancelAnimationFrame(a):void clearTimeout(a)}var e="function"==typeof window.requestAnimationFrame;$.zui({asap:a,clearAsap:n})}(),function(a){"use strict";function n(n,e,t){"boolean"==typeof e&&(t=e,e=null);var i=a(n),r=a(e?e:window),d=r.scrollTop(),o=d+r.height(),s=i.offset().top,l=s+i.height();return t?d<s&&o>l:s<=o&&l>=d}var e="zui.virtualRender",t=function(n,i){"function"==typeof i&&(i={render:i});var r=this;r.name=e,r.$=a(n),r.options=i=a.extend({},t.DEFAULTS,this.$.data(),i),r.rendered=!1;var d=r.options.conatiner,o=a(d?d:window);r.tryRender()||(r.$container=o,r.scrollListener=r.tryRender.bind(r),i.pendingClass&&r.$.addClass(i.pendingClass),o.on("scroll",r.scrollListener))};t.prototype.tryRender=function(){var e=this;return!(e.rendered||!n(e.$))&&(e.renderTaskID&&a.zui.clearAsap(e.renderTaskID),e.renderTaskID=a.zui.asap(function(){e.renderTaskID=null;var a=e.options.render(e.$);a!==!1&&(e.rendered=!0,e.destroy())},e.options.delay),!0)},t.prototype.destroy=function(){var n=this;n.renderTaskID&&a.zui.clearAsap(n.renderTaskID),n.scrollListener&&(n.$container.off("scroll",n.scrollListener),n.scrollListener=null);var t=n.options.pendingClass;t&&n.$.removeClass(t),n.$.removeData(e)},t.DEFAULTS={pendingClass:"virtual-pending"},a.fn.virtualRender=function(n){return this.each(function(){var i=a(this),r=i.data(e),d=n;if(r){if("string"==typeof n)return r[n]();r.destroy()}i.data(e,r=new t(this,d))})},a.zui.isScrolledIntoView=n}(jQuery),function(a){"use strict";var n="zui.kanban",e="object"==typeof CSS&&CSS.supports("display","flex"),t=function(i,r){var d=(a.zui.uuid(),this);d.name=n,d.$=a(i).addClass("kanban"),d.options=r=a.extend({},t.DEFAULTS,this.$.data(),r),r.useFlex&&!e&&(r.useFlex=!1),d.$.toggleClass("no-flex",!r.useFlex).toggleClass("use-flex",!!r.useFlex);var o=!!a.fn.virtualRender&&d.options.virtualize;if(o&&("object"!=typeof o&&(o={lane:!0}),d.virtualize=a.extend({},o)),d.data=r.data||[],d.timers={},d.render(d.data),r.onAction){var s=function(n){var e=a(this);r.onAction(e.data("action"),e,n,d)};d.$.on("click",".action",s).on("dblclick",".action-dbc",s)}if("auto"===r.droppable&&(r.droppable=!r.readonly),r.droppable){var l=0,c={dropOnMouseleave:!0,selector:".kanban-item",target:'.kanban-lane-col:not([data-type="EMPTY"])',drop:function(a){"function"==typeof r.droppable?r.droppable(a):r.onAction&&r.onAction("dropItem",a.element,a,d)},start:function(n){d.$.addClass("kanban-dragging"),l&&clearTimeout(l),l=setTimeout(function(){a(n.shadowElement).addClass("in"),l=0},50)},always:function(){d.$.removeClass("kanban-dragging"),l&&(clearTimeout(l),l=0)}};"object"==typeof r.droppable&&a.extend(c,r.droppable),d.$.droppable(c)}if(!r.useFlex){var h=0;a(window).on("resize",function(){h&&a.zui.clearAsap(h),h=a.zui.asap(function(){h=0,d.adjustSize()})})}r.onCreate&&r.onCreate(d)};t.prototype.render=function(a){var n=this;a&&(n.data=a),n.data&&!Array.isArray(n.data)&&(n.data=[n.data]);var t=n.data||[];n.options.beforeRender&&n.options.beforeRender(n,t),n.$.toggleClass("kanban-readonly",!!n.options.readonly).toggleClass("kanban-no-lane-name",!!n.options.noLaneName),n.$.children(".kanban-board").addClass("kanban-expired");for(var i=0;i<t.length;++i)n.renderKanban(i);n.$.children(".kanban-expired").remove(),e&&n.options.useFlex||setTimeout(n.adjustSize.bind(this),200),n.options.onRender&&n.options.onRender(n)},t.prototype.renderKanban=function(n){var e=this;if("number"==typeof n)n=e.data[n];else{var t=e.data.findIndex(function(a){return a.id===n.id});if(t>-1){var i=e.data[t];n=a.extend(i,n),e.data[t]=n}else e.data.push(n)}n.id||(n.id=a.zui.uuid());var r=n.id,d=e.options,o=e.$,s=o.children('.kanban-board[data-id="'+r+'"]');s.length?s.removeClass("kanban-expired"):s=a('<div class="kanban-board" data-id="'+r+'"></div>').appendTo(o);for(var l=n.columns,c=d.noLaneName?0:d.laneNameWidth,h=0,u={},p=!1,b=0;b<l.length;++b){var v=l[b];if(v.$cardsCount=0,v.$kanbanData=n,v.id||(v.id=v.type),v.asParent)p=!0,v.subs=[],u[v.type]=v;else if(v.parentType){var f=u[v.parentType];f.subs.push(v)}v.asParent||h++}var m=d.minColWidth*h+c,k=d.fluidBoardWidth?m:Math.max(m,o.width()-a.zui.getScrollbarWidth());s.css("min-width",m);var C=Math.floor((k-c)/h);n.$layout={kanbanWidth:k,laneNameWidth:c,columnsCount:h,columnWidth:C,hasParentCol:p,columnsMap:u};for(var g=function(a,n,e){if(a.asParent)return 0;e=e||n.items||n.cards||{};var t=e[a.type]||[];if(a.$cardsCount+=t.length,a.parentType){var i=u[a.parentType];i.$cardsCount+=t.length}var r=t.length*(d.cardHeight+d.cardSpace)+d.cardSpace,o=n.$parent?d.maxSubColHeight||d.maxColHeight:d.maxColHeight,s=n.$parent?d.minSubColHeight||d.minColHeight:d.minColHeight,l=Math.max(s,Math.min(o,r));return d.calcColHeight&&(l=d.calcColHeight(a,n,t,l)),l},x=n.lanes||[],b=0;b<x.length;++b){var y=x[b];y.kanban=r,y.$index=b,y.$kanbanData=n,y.$height=0;var $=y.subLanes;if($){y.$height=0;for(var L=0;L<$.length;++L){var T=$[L];T.kanban=r,T.$parent=y,T.$index=L,T.$kanbanData=n,T.$height=0;for(var w=T.items||T.cards||{},H=0;H<l.length;++H)T.$height=Math.max(T.$height,g(l[H],T,w));y.$height+=T.$height,L>0&&d.subLaneSpace&&(y.$height+=d.subLaneSpace)}}else for(var w=y.items||y.cards||{},L=0;L<l.length;++L)y.$height=Math.max(y.$height,g(l[L],y,w))}e.renderKanbanHeader(n,s),s.children(".kanban-lane").addClass("kanban-expired");for(var x=n.lanes||[],b=0;b<x.length;++b)e.renderLane(x[b],l,s,n);s.children(".kanban-expired").remove(),d.onRenderKanban&&d.onRenderKanban(s,n,e)},t.prototype.renderKanbanHeader=function(n,e){var t=this,i=t.options,r=n.$layout.hasParentCol;e=e||t.$.children('.kanban-board[data-id="'+n.id+'"]');var d=e.children(".kanban-header");d.length||(d=a('<div class="kanban-header"></div>').prependTo(e),i.useFlex||d.addClass("clearfix")),d.css({height:(r?2:1)*i.headerHeight,paddingLeft:i.noLaneName?0:i.laneNameWidth}).toggleClass("kanban-header-has-parent",!!r),d.children(".kanban-col").addClass("kanban-expired");for(var o=n.columns,s=n.$layout.columnsMap||{},l=null,c=null,h=0;h<o.length;++h){var u=o[h];if(u.asParent)t.renderHeaderParentCol(o[h],d,l,n),l=u,c=null;else if(u.parentType){var p=s[u.parentType];t.renderHeaderCol(o[h],d,p,c,n),c=u}else t.renderHeaderCol(o[h],d,null,l,n),l=u,c=null}d.find(".kanban-expired").remove(),i.onRenderHeader&&i.onRenderHeader(d,n)},t.prototype.renderHeaderParentCol=function(n,e,t,i){var r=this,d=r.options,o=e.children('.kanban-header-parent-col[data-id="'+n.id+'"]'),s=t?e.children('.kanban-header-col[data-id="'+t.id+'"]:not(.kanban-expired)'):null;o.length?o.removeClass("kanban-expired").find(".kanban-header-sub-cols>.kanban-col").addClass("kanban-expired"):o=a(['<div class="kanban-col kanban-header-col kanban-header-parent-col" data-id="'+n.id+'">','<div class="kanban-header-col">','<div class="title">','<i class="icon"></i>','<span class="text"></span>',d.showCount?'<span class="count"></span>':"","</div>","</div>",'<div class="kanban-header-sub-cols">',"</div>","</div>"].join("")),s&&s.length?s.after(o):e.prepend(o),o.data("col",n).attr("data-type",n.type);var l=n.subs.length*i.$layout.columnWidth;d.useFlex?o.css("flex",n.subs.length+" "+n.subs.length+" "+l+"px"):o.css("width",l);var c=o.children(".kanban-header-col");c.find(".title>.icon").attr("class","icon icon-"+(n.icon||""));var h=c.find(".title>.text").text(n.name);if(n.color&&h.css("color",n.color),d.showCount){var u=void 0!==n.count?n.count:n.$cardsCount;d.showZeroCount||u||(u="");var p=c.find(".title>.count").text(u);d.onRenderCount&&d.onRenderCount(p,u,n,r)}d.onRenderHeaderCol&&d.onRenderHeaderCol(o,n,e,i)},t.prototype.renderHeaderCol=function(n,e,t,i,r){var d=this,o=d.options;if(n.parentType&&t){var s=e.children('.kanban-header-parent-col[data-id="'+t.id+'"]');e=s.children(".kanban-header-sub-cols")}var l=e.children('.kanban-header-col[data-id="'+n.id+'"]'),c=i?e.children('.kanban-header-col[data-id="'+i.id+'"]:not(.kanban-expired)'):null;l.length?l.removeClass("kanban-expired"):l=a(['<div class="kanban-col kanban-header-col" data-id="'+n.id+'">','<div class="title action-dbc" data-action="editCol">','<i class="icon"></i>','<span class="text"></span>',o.showCount?'<span class="count"></span>':"","</div>",'<div class="actions"></div>',"</div>"].join("")),c&&c.length?c.after(l):e.prepend(l),l.data("col",n).attr("data-type",n.type),o.useFlex?l.css("flex","1 1 "+r.$layout.columnWidth+"px"):l.css("width",r.$layout.columnWidth),l.find(".title>.icon").attr("class","icon icon-"+(n.icon||""));var h=l.find(".title>.text").text(n.name);if(n.color&&h.css("color",n.color),o.showCount){var u=void 0!==n.count?n.count:n.$cardsCount;o.showZeroCount||u||(u="");var p=l.find(".title>.count").text(u);o.onRenderCount&&o.onRenderCount(p,u,n,d)}o.onRenderHeaderCol&&o.onRenderHeaderCol(l,n,e,r)},t.prototype.renderLane=function(n,t,i,r){var d=this,o=d.options;i=i||d.$.children('.kanban-board[data-id="'+n.kanban+'"]');var s=i.children('.kanban-lane[data-id="'+n.id+'"]');s.length?s.removeClass("kanban-expired"):(s=a('<div class="kanban-lane" data-id="'+n.id+'"></div>').appendTo(i),e||s.addClass("clearfix"));var l=n.subLanes?n.subLanes.length:0;s.attr("data-index",n.$index).data("lane",n).toggleClass("has-sub-lane",l>0).css({height:n.$height}),d.virtualizeRender(r,"lane",s,function(){if(!o.noLaneName){var e=s.children('.kanban-lane-name[data-id="'+n.id+'"]');e.length||(e=a('<div class="kanban-lane-name action-dbc" data-action="editLaneName" data-id="'+n.id+'"></div>').appendTo(s)),e.empty().css("width",o.laneNameWidth).attr("title",n.name).append(a('<span class="text" />').text(n.name)),n.color&&e.css("background-color",n.color),o.onRenderLaneName&&o.onRenderLaneName(e,n,i,t,r)}s.children(".kanban-col,.kanban-sub-lanes").addClass("kanban-expired"),n.subLanes?d.renderSubLanes(n,t,s,r):d.renderLaneCards(t,n.items||n.cards||{},s,n,r),s.children(".kanban-expired").remove()},{lane:n,columns:t,kanban:r})},t.prototype.virtualizeRender=function(a,n,e,t,i){var r=this,d=r.virtualize,o=d?d[n]:null;return o?("function"==typeof o&&(o=o(i,e)),"number"==typeof o&&e.height(o),void e.virtualRender(t)):t()},t.prototype.renderSubLanes=function(n,e,t,i){var r=this,d=t.children('.kanban-sub-lanes[data-id="'+n.id+'"]');d.length?d.removeClass("kanban-expired"):d=a('<div class="kanban-sub-lanes" data-id="'+n.id+'"></div>').appendTo(t),d.data("lane",n),d.children(".kanban-sub-lane").addClass("kanban-expired");for(var o=0;o<n.subLanes.length;++o)r.renderSubLane(n.subLanes[o],e,d,i,o);d.children(".kanban-expired").remove()},t.prototype.renderSubLane=function(n,t,i,r,d){var o=i.children('.kanban-sub-lane[data-id="'+n.id+'"]');o.length?o.removeClass("kanban-expired"):(o=a('<div class="kanban-sub-lane" data-id="'+n.id+'"></div>').appendTo(i),e||o.addClass("clearfix")),o.attr("data-index",d).data("lane",n).css({height:n.$height}),o.children(".kanban-col").addClass("kanban-expired");var s=n.items||n.cards;s&&this.renderLaneCards(t,s,o,n,r),o.children(".kanban-expired").remove()},t.prototype.renderLaneCards=function(a,n,e,t,i){for(var r=this,d=null,o=0;o<a.length;++o){var s=a[o];if(!s.asParent){var l=r.renderLaneCol(s,e,d),c=n[s.type]||[];r.renderColumnCards(s,c,l,t,i),d=s}}},t.prototype.renderColumnCards=function(a,n,e,t,i){var r=e.find(".kanban-lane-items");r.children(".kanban-item").addClass("kanban-expired");for(var d=0;d<n.length;++d){var o=n[d];o.$index=d,o.$col=a,o.$lane=t,this.renderCard(o,r,a,t,i)}r.children(".kanban-expired").remove()},t.prototype.renderLaneCol=function(n,e,t){var i=this,r=i.options,d=e.children('.kanban-lane-col[data-id="'+n.id+'"]'),o=t?e.children('.kanban-lane-col[data-id="'+t.id+'"]:not(.kanban-expired)'):null;if(d.length?d.removeClass("kanban-expired"):(d=a('<div class="kanban-col kanban-lane-col" data-id="'+n.id+'"></div>'),"EMPTY"!==n.id&&(d.append('<div class="kanban-lane-items"></div>'),i.options.readonly||d.append(['<div class="kanban-lane-actions">','<button class="btn btn-default btn-block action" type="button" data-action="addItem"><span class="text-muted"><i class="icon icon-plus"></i> '+i.options.addItemText+"</span></button>","</div>"].join(""))),r.laneItemsClass&&d.find(".kanban-lane-items").addClass(r.laneItemsClass),r.laneColClass&&d.addClass(r.laneColClass)),o&&o.length)o.after(d);else{var s=e.children(".kanban-lane-name").first();s.length?s.after(d):e.prepend(d)}return d.attr({"data-parent":n.parentType?n.parentType:null,"data-type":n.type}),r.useFlex?d.css("flex","1 1 "+n.$kanbanData.$layout.columnWidth+"px"):d.css("width",n.$kanbanData.$layout.columnWidth),d},t.prototype.renderCard=function(n,e,t,i,r){var d=e.children('.kanban-item[data-id="'+n.id+'"]');if(d.length?d.removeClass("kanban-expired"):d=a('<div class="kanban-item" data-id="'+n.id+'"></div>').appendTo(e),d.data("item",n),this.options.itemRender)this.options.itemRender(n,d,t,i,r);else{var o=d.find(".title");o.length||(o=a('<div class="title"></div>').appendTo(d)),o.text(n.name||n.title)}return d},t.prototype.tryAdjustKanbanSize=function(a,n,e){},t.prototype.adjustKanbanSize=function(n,t){var i=this;"number"==typeof n&&(n=i.data[n]),i.timers[n.id]&&(a.zui.clearAsap(i.timers[n.id]),delete i.timers[n.id]);for(var r=n.columns,d=i.options.noLaneName?0:i.options.laneNameWidth,o=0,s=0;s<r.length;++s)r[s].asParent||o++;var l=i.options.fluidBoardWidth,c=i.options.minColWidth*o+d;if(t=t||i.$.children('.kanban-board[data-id="'+n.id+'"]'),t.removeClass("kanban-size-inited").css(l?"width":"min-width",c),!i.options.useFlex||!e){var h=l?c:Math.max(c,i.$.width()),u=Math.floor((h-d)/o);t.data("column-width",u),t.find(".kanban-col").each(function(){var n=a(this),e=u;n.hasClass("kanban-header-parent-col")&&(e*=n.attr("data-subs-count")),n.css("width",e)}),t.children(".kanban-lane").each(function(){var n=a(this);n.data("column-width",u);var e=n.height();n.children(".kanban-col,.kanban-sub-lanes").css("min-height",e)});var p=i.options.maxColHeight;"number"==typeof p&&p>0&&(t.children(".kanban-lane").each(function(){var n=a(this),e=n.height();n.children(".kanban-col,.kanban-sub-lanes").css("min-height",e)}),t.find(".kanban-lane:not(.has-sub-lane),.kanban-sub-lane").each(function(){var n=a(this),e=n.height(),t=n.children(".kanban-lane-col").css("height","auto");t.each(function(){e=Math.max(e,a(this).outerHeight())}),t.css("height",e)})),t.addClass("kanban-size-inited")}},t.prototype.adjustLaneSize=function(n,e){var t=this,i=t.options.maxColHeight,e=e||n.data("column-width"),r=n.children(".kanban-sub-lanes,.kanban-col");return i&&r.css("min-height",n.height()),n.hasClass("has-sub-lane")?r.children(".kanban-sub-lane").each(function(){t.adjustLaneSize(a(this),e)}):void n.find(".kanban-col").each(function(){var n=a(this),t=e;n.hasClass("kanban-header-parent-col")&&(t*=n.attr("data-subs-count")),n.css("width",t)})},t.prototype.adjustSize=function(){for(var a=0;a<this.data.length;++a);},t.DEFAULTS={minColWidth:100,maxColHeight:400,minColHeight:90,minSubColHeight:40,subLaneSpace:2,laneNameWidth:20,headerHeight:32,cardHeight:40,cardSpace:10,fluidBoardWidth:!1,addItemText:"添加条目",createColumnText:"添加看板列",useFlex:!0,itemRender:null,calcColHeight:null,droppable:"auto",readonly:!1,laneColClass:"",noLaneName:!1,showCount:!0,showZeroCount:!1,virtualize:!1},a.fn.kanban=function(e){return this.each(function(){var i=a(this),r=i.data(n),d="object"==typeof e&&e;r||i.data(n,r=new t(this,d)),"string"==typeof e&&r[e]()})},t.NAME=n,a.fn.kanban.Constructor=t}(jQuery);