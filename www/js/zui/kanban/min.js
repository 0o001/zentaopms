/*!
 * ZUI: ZUI Kanban View - v1.10.0 - 2021-11-30
 * http://openzui.com
 * GitHub: https://github.com/easysoft/zui.git 
 * Copyright (c) 2021 cnezsoft.com; Licensed MIT
 */
!function(){"use strict";function a(a,e){return n&&!e?requestAnimationFrame(a):setTimeout(a,e||0)}function e(a){return n?cancelAnimationFrame(a):void clearTimeout(a)}var n="function"==typeof window.requestAnimationFrame;$.zui({asap:a,clearAsap:e})}(),function(a){"use strict";function e(e,n,t){"boolean"==typeof n&&(t=n,n=null);var r=a(e),i=a(n?n:window),d=i.scrollTop(),o=d+i.height(),l=r.offset().top,s=l+r.height();return t?d<l&&o>s:l<=o&&s>=d}var n="zui.virtualRender",t=function(e,r){"function"==typeof r&&(r={render:r});var i=this;i.name=n,i.$=a(e),i.options=r=a.extend({},t.DEFAULTS,this.$.data(),r),i.rendered=!1;var d=i.options.conatiner,o=a(d?d:window);i.tryRender()||(i.$container=o,i.scrollListener=i.tryRender.bind(i),r.pendingClass&&i.$.addClass(r.pendingClass),o.on("scroll",i.scrollListener))};t.prototype.tryRender=function(){var n=this;return!(n.rendered||!e(n.$))&&(n.renderTaskID&&a.zui.clearAsap(n.renderTaskID),n.renderTaskID=a.zui.asap(function(){n.renderTaskID=null;var a=n.options.render(n.$);a!==!1&&(n.rendered=!0,n.destroy())},n.options.delay),!0)},t.prototype.destroy=function(){var e=this;e.renderTaskID&&a.zui.clearAsap(e.renderTaskID),e.scrollListener&&(e.$container.off("scroll",e.scrollListener),e.scrollListener=null);var t=e.options.pendingClass;t&&e.$.removeClass(t),e.$.removeData(n)},t.DEFAULTS={pendingClass:"virtual-pending"},a.fn.virtualRender=function(e){return this.each(function(){var r=a(this),i=r.data(n),d=e;if(i){if("string"==typeof e)return i[e]();i.destroy()}r.data(n,i=new t(this,d))})},a.zui.isScrolledIntoView=e}(jQuery),function(a){"use strict";var e="zui.kanban",n="object"==typeof CSS&&CSS.supports("display","flex"),t=function(r,i){var d=(a.zui.uuid(),this);d.name=e,d.$=a(r).addClass("kanban"),d.options=i=a.extend({},t.DEFAULTS,this.$.data(),i),i.useFlex&&!n&&(i.useFlex=!1),d.$.toggleClass("no-flex",!i.useFlex).toggleClass("use-flex",!!i.useFlex);var o=!!a.fn.virtualRender&&d.options.virtualize;if(o&&("object"!=typeof o&&(o={lane:!0}),d.virtualize=a.extend({},o)),d.data=i.data||[],d.timers={},d.render(d.data),i.onAction){var l=function(e){var n=a(this);i.onAction(n.data("action"),n,e,d)};d.$.on("click",".action",l).on("dblclick",".action-dbc",l)}if("auto"===i.droppable&&(i.droppable=!i.readonly),i.droppable){var s=0,c={dropOnMouseleave:!0,selector:".kanban-item",target:'.kanban-lane-col:not([data-type="EMPTY"])',drop:function(a){"function"==typeof i.droppable?i.droppable(a):i.onAction&&i.onAction("dropItem",a.element,a,d)},start:function(e){d.$.addClass("kanban-dragging"),s&&clearTimeout(s),s=setTimeout(function(){a(e.shadowElement).addClass("in"),s=0},50)},always:function(){d.$.removeClass("kanban-dragging"),s&&(clearTimeout(s),s=0)}};"object"==typeof i.droppable&&a.extend(c,i.droppable),d.$.droppable(c)}if(!i.useFlex){var p=0;a(window).on("resize",function(){p&&a.zui.clearAsap(p),p=a.zui.asap(function(){p=0,d.adjustSize()})})}i.onCreate&&i.onCreate(d)};t.prototype.render=function(a){var e=this;a&&(e.data=a),e.data&&!Array.isArray(e.data)&&(e.data=[e.data]);var t=e.data||[];e.options.beforeRender&&e.options.beforeRender(e,t),e.$.toggleClass("kanban-readonly",!!e.options.readonly).toggleClass("kanban-no-lane-name",!!e.options.noLaneName),e.$.children(".kanban-board").addClass("kanban-expired");for(var r=0;r<t.length;++r)e.renderKanban(r);e.$.children(".kanban-expired").remove(),n&&e.options.useFlex||setTimeout(e.adjustSize.bind(this),200),e.options.onRender&&e.options.onRender(e)},t.prototype.renderKanban=function(e){var n=this;if("number"==typeof e)e=n.data[e];else{var t=n.data.findIndex(function(a){return a.id===e.id});if(t>-1){var r=n.data[t];e=a.extend(r,e),n.data[t]=e}else n.data.push(e)}e.id||(e.id=a.zui.uuid());var i=e.id,d=n.options,o=n.$,l=o.children('.kanban-board[data-id="'+i+'"]');l.length?l.removeClass("kanban-expired"):l=a('<div class="kanban-board" data-id="'+i+'"></div>').appendTo(o);for(var s=e.columns,c=d.noLaneName?0:d.laneNameWidth,p=0,u={},h=!1,b=0;b<s.length;++b){var v=s[b];if(v.$cardsCount=0,v.$kanbanData=e,v.id||(v.id=v.type),v.asParent)h=!0,v.subs=[],u[v.type]=v;else if(v.parentType){var f=u[v.parentType];f.subs.push(v)}v.asParent||p++}var m=d.minColWidth*p+c,k=d.fluidBoardWidth?Math.max(m,o.width()-a.zui.getScrollbarWidth()):m;l.css(d.fluidBoardWidth?"min-width":"width",m);var C=Math.floor((k-c)/p);e.$layout={kanbanWidth:k,laneNameWidth:c,columnsCount:p,columnWidth:C,hasParentCol:h,columnsMap:u};for(var g=function(a,e,n){if(a.asParent)return 0;n=n||e.items||e.cards||{};var t=n[a.type]||[];if(a.$cardsCount+=t.length,a.parentType){var r=u[a.parentType];r.$cardsCount+=t.length}var i=t.length*(d.cardHeight+d.cardSpace)+d.cardSpace,o=e.$parent?d.maxSubColHeight||d.maxColHeight:d.maxColHeight,l=e.$parent?d.minSubColHeight||d.minColHeight:d.minColHeight,s=Math.max(l,Math.min(o,i));return d.calcColHeight&&(s=d.calcColHeight(a,e,t,s)),s},x=e.lanes||[],b=0;b<x.length;++b){var y=x[b];y.kanban=i,y.$index=b,y.$kanbanData=e,y.$height=0;var $=y.subLanes;if($){y.$height=0;for(var L=0;L<$.length;++L){var T=$[L];T.kanban=i,T.$parent=y,T.$index=L,T.$kanbanData=e,T.$height=0;for(var R=T.items||T.cards||{},H=0;H<s.length;++H)T.$height=Math.max(T.$height,g(s[H],T,R));y.$height+=T.$height,L>0&&d.subLaneSpace&&(y.$height+=d.subLaneSpace)}}else for(var R=y.items||y.cards||{},L=0;L<s.length;++L)y.$height=Math.max(y.$height,g(s[L],y,R))}n.renderKanbanHeader(e,l),l.children(".kanban-lane").addClass("kanban-expired");for(var x=e.lanes||[],b=0;b<x.length;++b)n.renderLane(x[b],s,l,e);l.children(".kanban-expired").remove(),d.onRenderKanban&&d.onRenderKanban(l,e,n)},t.prototype.renderKanbanHeader=function(e,n){var t=this,r=t.options,i=e.$layout.hasParentCol;n=n||t.$.children('.kanban-board[data-id="'+e.id+'"]');var d=n.children(".kanban-header");d.length||(d=a('<div class="kanban-header"></div>').prependTo(n),r.useFlex||d.addClass("clearfix")),d.css({height:(i?2:1)*r.headerHeight,paddingLeft:r.noLaneName?0:r.laneNameWidth}).toggleClass("kanban-header-has-parent",!!i),d.children(".kanban-col").addClass("kanban-expired");for(var o=e.columns,l=e.$layout.columnsMap||{},s=null,c=null,p=0;p<o.length;++p){var u=o[p];if(u.asParent)t.renderHeaderParentCol(o[p],d,s,e),s=u,c=null;else if(u.parentType){var h=l[u.parentType];t.renderHeaderCol(o[p],d,h,c,e),c=u}else t.renderHeaderCol(o[p],d,null,s,e),s=u,c=null}d.find(".kanban-expired").remove(),r.onRenderHeader&&r.onRenderHeader(d,e)},t.prototype.renderHeaderParentCol=function(e,n,t,r){var i=this,d=i.options,o=n.children('.kanban-header-parent-col[data-id="'+e.id+'"]'),l=t?n.children('.kanban-header-col[data-id="'+t.id+'"]:not(.kanban-expired)'):null;o.length?o.removeClass("kanban-expired").find(".kanban-header-sub-cols>.kanban-col").addClass("kanban-expired"):o=a(['<div class="kanban-col kanban-header-col kanban-header-parent-col" data-id="'+e.id+'">','<div class="kanban-header-col">','<div class="title">','<i class="icon"></i>','<span class="text"></span>',d.showCount?'<span class="count"></span>':"","</div>","</div>",'<div class="kanban-header-sub-cols">',"</div>","</div>"].join("")),l&&l.length?l.after(o):n.prepend(o),o.data("col",e).attr("data-type",e.type);var s=e.subs.length*r.$layout.columnWidth;d.useFlex?o.css("flex",e.subs.length+" "+e.subs.length+" "+s+"px"):o.css("width",s);var c=o.children(".kanban-header-col");c.find(".title>.icon").attr("class","icon icon-"+(e.icon||""));var p=c.find(".title>.text").text(e.name);if(e.color&&p.css("color",e.color),d.showCount){var u=void 0!==e.count?e.count:e.$cardsCount;d.showZeroCount||u||(u="");var h=c.find(".title>.count").text(u);d.onRenderCount&&d.onRenderCount(h,u,e,i)}d.onRenderHeaderCol&&d.onRenderHeaderCol(o,e,n,r)},t.prototype.renderHeaderCol=function(e,n,t,r,i){var d=this,o=d.options;if(e.parentType&&t){var l=n.children('.kanban-header-parent-col[data-id="'+t.id+'"]');n=l.children(".kanban-header-sub-cols")}var s=n.children('.kanban-header-col[data-id="'+e.id+'"]'),c=r?n.children('.kanban-header-col[data-id="'+r.id+'"]:not(.kanban-expired)'):null;s.length?s.removeClass("kanban-expired"):s=a(['<div class="kanban-col kanban-header-col" data-id="'+e.id+'">','<div class="title action-dbc" data-action="editCol">','<i class="icon"></i>','<span class="text"></span>',o.showCount?'<span class="count"></span>':"","</div>",'<div class="actions"></div>',"</div>"].join("")),c&&c.length?c.after(s):n.prepend(s),s.data("col",e).attr("data-type",e.type),o.useFlex?s.css("flex","1 1 "+i.$layout.columnWidth+"px"):s.css("width",i.$layout.columnWidth),s.find(".title>.icon").attr("class","icon icon-"+(e.icon||""));var p=s.find(".title>.text").text(e.name);if(e.color&&p.css("color",e.color),o.showCount){var u=void 0!==e.count?e.count:e.$cardsCount;o.showZeroCount||u||(u="");var h=s.find(".title>.count").text(u);o.onRenderCount&&o.onRenderCount(h,u,e,d)}o.onRenderHeaderCol&&o.onRenderHeaderCol(s,e,n,i)},t.prototype.renderLane=function(e,t,r,i){var d=this,o=d.options;r=r||d.$.children('.kanban-board[data-id="'+e.kanban+'"]');var l=r.children('.kanban-lane[data-id="'+e.id+'"]');l.length?l.removeClass("kanban-expired"):(l=a('<div class="kanban-lane" data-id="'+e.id+'"></div>').appendTo(r),n||l.addClass("clearfix"));var s=e.subLanes?e.subLanes.length:0;l.attr("data-index",e.$index).data("lane",e).toggleClass("has-sub-lane",s>0).css({height:e.$height}),d.virtualizeRender(i,"lane",l,function(){if(!o.noLaneName){var n=l.children('.kanban-lane-name[data-id="'+e.id+'"]');n.length||(n=a('<div class="kanban-lane-name action-dbc" data-action="editLaneName" data-id="'+e.id+'"></div>').appendTo(l)),n.empty().css("width",o.laneNameWidth).attr("title",e.name).append(a('<span class="text" />').text(e.name)),e.color&&n.css("background-color",e.color),o.onRenderLaneName&&o.onRenderLaneName(n,e,r,t,i)}l.children(".kanban-col,.kanban-sub-lanes").addClass("kanban-expired"),e.subLanes?d.renderSubLanes(e,t,l,i):d.renderLaneCards(t,e.items||e.cards||{},l,e,i),l.children(".kanban-expired").remove()},{lane:e,columns:t,kanban:i})},t.prototype.virtualizeRender=function(a,e,n,t,r){var i=this,d=i.virtualize,o=d?d[e]:null;return o?("function"==typeof o&&(o=o(r,n)),"number"==typeof o&&n.height(o),void n.virtualRender(t)):t()},t.prototype.renderSubLanes=function(e,n,t,r){var i=this,d=t.children('.kanban-sub-lanes[data-id="'+e.id+'"]');d.length?d.removeClass("kanban-expired"):d=a('<div class="kanban-sub-lanes" data-id="'+e.id+'"></div>').appendTo(t),d.data("lane",e),d.children(".kanban-sub-lane").addClass("kanban-expired");for(var o=0;o<e.subLanes.length;++o)i.renderSubLane(e.subLanes[o],n,d,r,o);d.children(".kanban-expired").remove()},t.prototype.renderSubLane=function(e,t,r,i,d){var o=r.children('.kanban-sub-lane[data-id="'+e.id+'"]');o.length?o.removeClass("kanban-expired"):(o=a('<div class="kanban-sub-lane" data-id="'+e.id+'"></div>').appendTo(r),n||o.addClass("clearfix")),o.attr("data-index",d).data("lane",e).css({height:e.$height}),o.children(".kanban-col").addClass("kanban-expired");var l=e.items||e.cards;l&&this.renderLaneCards(t,l,o,e,i),o.children(".kanban-expired").remove()},t.prototype.renderLaneCards=function(a,e,n,t,r){for(var i=this,d=null,o=0;o<a.length;++o){var l=a[o];if(!l.asParent){var s=i.renderLaneCol(l,n,d),c=e[l.type]||[];i.renderColumnCards(l,c,s,t,r),d=l}}},t.prototype.renderColumnCards=function(a,e,n,t,r){var i=n.find(".kanban-lane-items");i.children(".kanban-item").addClass("kanban-expired");for(var d=0;d<e.length;++d){var o=e[d];o.$index=d,o.$col=a,o.$lane=t,this.renderCard(o,i,a,t,r)}i.children(".kanban-expired").remove()},t.prototype.renderLaneCol=function(e,n,t){var r=this,i=r.options,d=n.children('.kanban-lane-col[data-id="'+e.id+'"]'),o=t?n.children('.kanban-lane-col[data-id="'+t.id+'"]:not(.kanban-expired)'):null;if(d.length?d.removeClass("kanban-expired"):(d=a('<div class="kanban-col kanban-lane-col" data-id="'+e.id+'"></div>'),"EMPTY"!==e.id&&(d.append('<div class="kanban-lane-items"></div>'),r.options.readonly||d.append(['<div class="kanban-lane-actions">','<button class="btn btn-default btn-block action" type="button" data-action="addItem"><span class="text-muted"><i class="icon icon-plus"></i> '+r.options.addItemText+"</span></button>","</div>"].join(""))),i.laneItemsClass&&d.find(".kanban-lane-items").addClass(i.laneItemsClass),i.laneColClass&&d.addClass(i.laneColClass)),o&&o.length)o.after(d);else{var l=n.children(".kanban-lane-name").first();l.length?l.after(d):n.prepend(d)}return d.attr({"data-parent":e.parentType?e.parentType:null,"data-type":e.type}),i.useFlex?d.css("flex","1 1 "+e.$kanbanData.$layout.columnWidth+"px"):d.css("width",e.$kanbanData.$layout.columnWidth),d},t.prototype.renderCard=function(e,n,t,r,i){var d=n.children('.kanban-item[data-id="'+e.id+'"]');if(d.length?d.removeClass("kanban-expired"):d=a('<div class="kanban-item" data-id="'+e.id+'"></div>').appendTo(n),d.data("item",e),this.options.itemRender)this.options.itemRender(e,d,t,r,i);else{var o=d.find(".title");o.length||(o=a('<div class="title"></div>').appendTo(d)),o.text(e.name||e.title)}return d},t.prototype.tryAdjustKanbanSize=function(a,e,n){},t.prototype.adjustKanbanSize=function(a,e){},t.prototype.adjustLaneSize=function(a,e){},t.prototype.adjustSize=function(){},t.DEFAULTS={minColWidth:100,maxColHeight:400,minColHeight:90,minSubColHeight:40,subLaneSpace:2,laneNameWidth:20,headerHeight:32,cardHeight:40,cardSpace:10,fluidBoardWidth:!0,addItemText:"添加条目",createColumnText:"添加看板列",useFlex:!0,itemRender:null,calcColHeight:null,droppable:"auto",readonly:!1,laneColClass:"",noLaneName:!1,showCount:!0,showZeroCount:!1,virtualize:!1},a.fn.kanban=function(n){return this.each(function(){var r=a(this),i=r.data(e),d="object"==typeof n&&n;i||r.data(e,i=new t(this,d)),"string"==typeof n&&i[n]()})},t.NAME=e,a.fn.kanban.Constructor=t}(jQuery);