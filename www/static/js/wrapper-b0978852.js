var te=Object.defineProperty,ne=Object.defineProperties;var oe=Object.getOwnPropertyDescriptors;var L=Object.getOwnPropertySymbols;var ie=Object.prototype.hasOwnProperty,se=Object.prototype.propertyIsEnumerable;var b=(t,e,n)=>e in t?te(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,u=(t,e)=>{for(var n in e||(e={}))ie.call(e,n)&&b(t,n,e[n]);if(L)for(var n of L(e))se.call(e,n)&&b(t,n,e[n]);return t},I=(t,e)=>ne(t,oe(e));var R=(t,e,n)=>new Promise((i,o)=>{var a=r=>{try{d(n.next(r))}catch(l){o(l)}},s=r=>{try{d(n.throw(r))}catch(l){o(l)}},d=r=>r.done?i(r.value):Promise.resolve(r.value).then(a,s);d((n=n.apply(t,e)).next())});import{g as N}from"./storage-6704c6cd.js";import{az as v,aH as re,j as x,d as S,o as h,m as w,A as D,ad as F,f as c,aI as B,aJ as y,aK as z,aL as G,aM as M,c as _,aN as j,aO as q,L as U,F as V,a5 as m,x as A,v as p,aP as g,a6 as f,z as ae,e as k,ab as O,aQ as W,aR as ce,S as de}from"./index.js";import{c as le,u as ue,C as he}from"./chartEditStore-050ca7fc.js";import{t as C,u as we,f as pe}from"./index-eabebd32.js";import"./plugin-72724cd5.js";import"./icon-39b42501.js";import"./table_scrollboard-3d700369.js";import"./SizeSetting.vue_vue_type_style_index_0_scoped_true_lang-dbf67a06.js";import"./useTargetData.hook-58ebdad7.js";const ge=(t,e,n,i)=>{const o=t,a=e,s={width:1,height:1},d=parseFloat((o/a).toFixed(5)),r=()=>{const ee=parseFloat((window.innerWidth/window.innerHeight).toFixed(5));n&&(ee>d?(s.width=parseFloat((window.innerHeight*d/o).toFixed(5)),s.height=parseFloat((window.innerHeight/a).toFixed(5)),n.style.transform=`scale(${s.width}, ${s.height})`):(s.height=parseFloat((window.innerWidth/d/a).toFixed(5)),s.width=parseFloat((window.innerWidth/o).toFixed(5)),n.style.transform=`scale(${s.width}, ${s.height})`),i&&i(s))},l=C(()=>{r()},200);return{calcRate:r,windowResize:()=>{window.addEventListener("resize",l)},unWindowResize:()=>{window.removeEventListener("resize",l)}}},ve=(t,e,n,i)=>{const o=t,a=e,s={width:1,height:1},d=parseFloat((o/a).toFixed(5)),r=()=>{n&&(s.height=parseFloat((window.innerWidth/d/a).toFixed(5)),s.width=parseFloat((window.innerWidth/o).toFixed(5)),n.style.transform=`scale(${s.width}, ${s.height})`,i&&i(s))},l=C(()=>{r()},200);return{calcRate:r,windowResize:()=>{window.addEventListener("resize",l)},unWindowResize:()=>{window.removeEventListener("resize",l)}}},fe=(t,e,n,i)=>{const o=t,a=e,s={height:1,width:1},d=parseFloat((o/a).toFixed(5)),r=()=>{n&&(s.width=parseFloat((window.innerHeight*d/o).toFixed(5)),s.height=parseFloat((window.innerHeight/a).toFixed(5)),n.style.transform=`scale(${s.width}, ${s.height})`,i&&i(s))},l=C(()=>{r()},200);return{calcRate:r,windowResize:()=>{window.addEventListener("resize",l)},unWindowResize:()=>{window.removeEventListener("resize",l)}}},ye=(t,e,n,i)=>{const o={width:1,height:1},a=()=>{n&&(o.width=parseFloat((window.innerWidth/t).toFixed(5)),o.height=parseFloat((window.innerHeight/e).toFixed(5)),n.style.transform=`scale(${o.width}, ${o.height})`,i&&i(o))},s=C(()=>{a()},200);return{calcRate:a,windowResize:()=>{window.addEventListener("resize",s)},unWindowResize:()=>{window.removeEventListener("resize",s)}}},K={},T={echarts:re},X=t=>{if(!t.events)return{};const e={};for(const o in t.events.baseEvent){const a=t.events.baseEvent[o];a&&(e[o]=_e(a))}const n=t.events.advancedEvents||{},i={[v.VNODE_BEFORE_MOUNT](o){K[t.id]=o.component;const a=(n[v.VNODE_BEFORE_MOUNT]||"").trim();P(a,o)},[v.VNODE_MOUNTED](o){const a=(n[v.VNODE_MOUNTED]||"").trim();P(a,o)}};return u(u({},e),i)};function _e(t){try{return new Function(`
      return (
        async function(mouseEvent){
          ${t}
        }
      )`)()}catch(e){console.error(e)}}function P(t,e){try{Function(`
      "use strict";
      return (
        async function(e, components, node_modules){
          const {${Object.keys(T).join()}} = node_modules;
          ${t}
        }
      )`)().bind(e==null?void 0:e.component)(e,K,T)}catch(n){console.error(n)}}const Y=(t,e)=>({zIndex:e+1,left:`${t.x}px`,top:`${t.y}px`}),J=(t,e)=>({width:`${e?e*t.w:t.w}px`,height:`${e?e*t.h:t.h}px`}),Q=t=>({display:t.hide?"none":"block"}),Z=t=>{const e={};return t&&t.overFlowHidden&&(e.overflow="hidden"),e},me=t=>{const e=t.selectColor?{background:t.background}:{background:`url(${t.backgroundImage}) center center / cover no-repeat !important`};return u({position:"relative",width:t.width?`${t.width||100}px`:"100%",height:t.height?`${t.height}px`:"100%"},e)};const Se=S({__name:"index",props:{groupData:{type:Object,required:!0},themeSetting:{type:Object,required:!0},themeColor:{type:Object,required:!0},groupIndex:{type:Number,required:!0}},setup(t){return(e,n)=>(h(!0),w(V,null,D(t.groupData.groupList,i=>(h(),w("div",{class:F(["chart-item",c(B)(i.styles.animations)]),key:i.id,style:y(u(u(u(u(u(u({},c(Y)(i.attr,t.groupIndex)),c(z)(i.styles)),c(G)(i.styles)),c(Q)(i.status)),c(Z)(i.preview)),c(M)(i.styles)))},[(h(),_(U(i.chartConfig.chartKey),j({id:i.id,chartConfig:i,themeSetting:t.themeSetting,themeColor:t.themeColor,style:u({},c(J)(i.attr))},q(c(X)(i))),null,16,["id","chartConfig","themeSetting","themeColor","style"]))],6))),128))}});var Ce=x(Se,[["__scopeId","data-v-78cb40c3"]]);const Re=S({__name:"index",props:{localStorageInfo:{type:Object,required:!0}},setup(t){const e=t,{initDataPond:n,clearMittDataPondMap:i}=we(),o=m(()=>e.localStorageInfo.editCanvasConfig.chartThemeSetting),a=m(()=>{const s=e.localStorageInfo.editCanvasConfig.chartThemeColor;return le[s]});return i(),A(()=>{n(e.localStorageInfo.requestGlobalConfig)}),(s,d)=>(h(!0),w(V,null,D(t.localStorageInfo.componentList,(r,l)=>(h(),w("div",{class:F(["chart-item",c(B)(r.styles.animations)]),key:r.id,style:y(u(u(u(u(u(u({},c(Y)(r.attr,l)),c(z)(r.styles)),c(G)(r.styles)),c(Q)(r.status)),c(Z)(r.preview)),c(M)(r.styles)))},[r.isGroup?(h(),_(c(Ce),{key:0,groupData:r,groupIndex:l,themeSetting:c(o),themeColor:c(a)},null,8,["groupData","groupIndex","themeSetting","themeColor"])):(h(),_(U(r.chartConfig.chartKey),j({key:1,id:r.id,chartConfig:r,themeSetting:c(o),themeColor:c(a),style:u({},c(J)(r.attr))},q(c(X)(r))),null,16,["id","chartConfig","themeSetting","themeColor","style"]))],6))),128))}});var H=x(Re,[["__scopeId","data-v-8e1419e2"]]);const xe=t=>{const e=p(!1),n=setInterval(()=>{if(window.$vue.component){clearInterval(n);const i=o=>{window.$vue.component(o.chartConfig.chartKey)||window.$vue.component(o.chartConfig.chartKey,pe(o.chartConfig))};t.componentList.forEach(o=>R(void 0,null,function*(){o.isGroup?o.groupList.forEach(a=>{i(a)}):i(o)})),e.value=!0}},200);return{show:e}},Fe=t=>{const e=p(),n=p(),i=p(t.editCanvasConfig.width),o=p(t.editCanvasConfig.height);return A(()=>{switch(t.editCanvasConfig.previewScaleType){case g.FIT:(()=>{const{calcRate:a,windowResize:s,unWindowResize:d}=ge(i.value,o.value,n.value);a(),s(),f(()=>{d()})})();break;case g.SCROLL_Y:(()=>{const{calcRate:a,windowResize:s,unWindowResize:d}=ve(i.value,o.value,n.value,r=>{const l=e.value;l.style.width=`${i.value*r.width}px`,l.style.height=`${o.value*r.height}px`});a(),s(),f(()=>{d()})})();break;case g.SCROLL_X:(()=>{const{calcRate:a,windowResize:s,unWindowResize:d}=fe(i.value,o.value,n.value,r=>{const l=e.value;l.style.width=`${i.value*r.width}px`,l.style.height=`${o.value*r.height}px`});a(),s(),f(()=>{d()})})();break;case g.FULL:(()=>{const{calcRate:a,windowResize:s,unWindowResize:d}=ye(i.value,o.value,n.value);a(),s(),f(()=>{d()})})();break}}),{entityRef:e,previewRef:n}},ze=t=>{const e=ue();e.requestGlobalConfig=t[he.REQUEST_GLOBAL_CONFIG]};const Ee=S({__name:"index",setup(t){const e=N(),n=m(()=>u(u({},me(e.editCanvasConfig)),z(e.editCanvasConfig))),i=m(()=>{const d=e.editCanvasConfig.previewScaleType;return d===g.SCROLL_Y||d===g.SCROLL_X});ze(e);const{entityRef:o,previewRef:a}=Fe(e),{show:s}=xe(e);return(d,r)=>(h(),w("div",{class:F(`go-preview ${c(e).editCanvasConfig.previewScaleType}`)},[c(i)?(h(),w("div",{key:0,ref_key:"entityRef",ref:o,class:"go-preview-entity"},[ae("div",{ref_key:"previewRef",ref:a,class:"go-preview-scale"},[c(s)?(h(),w("div",{key:0,style:y(c(n))},[k(c(H),{localStorageInfo:c(e)},null,8,["localStorageInfo"])],4)):O("",!0)],512)],512)):(h(),w("div",{key:1,ref_key:"previewRef",ref:a,class:"go-preview-scale"},[c(s)?(h(),w("div",{key:0,style:y(c(n))},[k(c(H),{localStorageInfo:c(e)},null,8,["localStorageInfo"])],4)):O("",!0)],512))],2))}});var $e=x(Ee,[["__scopeId","data-v-5663438e"]]);const De=S({__name:"wrapper",setup(t){let e=p(Date.now());return[W.JSON,W.CHART].forEach(n=>{!window.opener||window.opener.addEventListener(n,i=>R(this,null,function*(){const o=yield N();ce(de.GO_CHART_STORAGE_LIST,[I(u({},i.detail),{id:o.id})]),e.value=Date.now()}))}),(n,i)=>(h(),_($e,{key:c(e)}))}});export{De as default};
