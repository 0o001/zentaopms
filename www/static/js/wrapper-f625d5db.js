var de=Object.defineProperty,le=Object.defineProperties;var ue=Object.getOwnPropertyDescriptors;var H=Object.getOwnPropertySymbols;var he=Object.prototype.hasOwnProperty,we=Object.prototype.propertyIsEnumerable;var D=(e,t,n)=>t in e?de(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,h=(e,t)=>{for(var n in t||(t={}))he.call(t,n)&&D(e,n,t[n]);if(H)for(var n of H(t))we.call(t,n)&&D(e,n,t[n]);return e},M=(e,t)=>le(e,ue(t));var k=(e,t,n)=>new Promise((s,o)=>{var r=d=>{try{c(n.next(d))}catch(l){o(l)}},i=d=>{try{c(n.throw(d))}catch(l){o(l)}},c=d=>d.done?s(d.value):Promise.resolve(d.value).then(r,i);c((n=n.apply(e,t)).next())});import{g as q}from"./storage-009bd72e.js";import{aG as S,bT as pe,j as W,d as $,o as p,m as v,A as j,ad as P,f as a,bU as K,aP as x,bV as I,bW as X,bX as Y,c as C,bY as J,bZ as Q,L as Z,F as ee,v as y,a5 as F,x as te,r as T,aa as E,w as A,e as z,p as ve,z as ne,b_ as m,a6 as R,b$ as B,c0 as ge,S as fe}from"./index.js";import{t as b,u as oe,c as ye,F as _e,d as Ce,e as me,f as Se,C as O}from"./useSync.hook-cae0f7f7.js";import"./plugin-25b8b76b.js";import"./icon-a9afa6f2.js";import"./tables_list-a4e5b822.js";const Re=(e,t,n,s)=>{const o=e,r=t,i={width:1,height:1},c=parseFloat((o/r).toFixed(5)),d=()=>{const _=parseFloat((window.innerWidth/window.innerHeight).toFixed(5));n&&(_>c?(i.width=parseFloat((window.innerHeight*c/o).toFixed(5)),i.height=parseFloat((window.innerHeight/r).toFixed(5)),n.style.transform=`scale(${i.width}, ${i.height})`):(i.height=parseFloat((window.innerWidth/c/r).toFixed(5)),i.width=parseFloat((window.innerWidth/o).toFixed(5)),n.style.transform=`scale(${i.width}, ${i.height})`),s&&s(i))},l=b(()=>{d()},200);return{calcRate:d,windowResize:()=>{window.addEventListener("resize",l)},unWindowResize:()=>{window.removeEventListener("resize",l)}}},xe=(e,t,n,s)=>{const o=e,r=t,i={width:1,height:1},c=parseFloat((o/r).toFixed(5)),d=()=>{n&&(i.height=parseFloat((window.innerWidth/c/r).toFixed(5)),i.width=parseFloat((window.innerWidth/o).toFixed(5)),n.style.transform=`scale(${i.width}, ${i.height})`,s&&s(i))},l=b(()=>{d()},200);return{calcRate:d,windowResize:()=>{window.addEventListener("resize",l)},unWindowResize:()=>{window.removeEventListener("resize",l)}}},Fe=(e,t,n,s)=>{const o=e,r=t,i={height:1,width:1},c=parseFloat((o/r).toFixed(5)),d=()=>{n&&(i.width=parseFloat((window.innerHeight*c/o).toFixed(5)),i.height=parseFloat((window.innerHeight/r).toFixed(5)),n.style.transform=`scale(${i.width}, ${i.height})`,s&&s(i))},l=b(()=>{d()},200);return{calcRate:d,windowResize:()=>{window.addEventListener("resize",l)},unWindowResize:()=>{window.removeEventListener("resize",l)}}},Ee=(e,t,n,s)=>{const o={width:1,height:1},r=()=>{n&&(o.width=parseFloat((window.innerWidth/e).toFixed(5)),o.height=parseFloat((window.innerHeight/t).toFixed(5)),n.style.transform=`scale(${o.width}, ${o.height})`,s&&s(o))},i=b(()=>{r()},200);return{calcRate:r,windowResize:()=>{window.addEventListener("resize",i)},unWindowResize:()=>{window.removeEventListener("resize",i)}}},se={},G={echarts:pe},ie=e=>{if(!e.events)return{};const t={};for(const o in e.events.baseEvent){const r=e.events.baseEvent[o];r&&(t[o]=ze(r))}const n=e.events.advancedEvents||{},s={[S.VNODE_BEFORE_MOUNT](o){se[e.id]=o.component;const r=(n[S.VNODE_BEFORE_MOUNT]||"").trim();V(r,o)},[S.VNODE_MOUNTED](o){const r=(n[S.VNODE_MOUNTED]||"").trim();V(r,o)}};return h(h({},t),s)};function ze(e){try{return new Function(`
      return (
        async function(mouseEvent){
          ${e}
        }
      )`)()}catch(t){console.error(t)}}function V(e,t){try{Function(`
      "use strict";
      return (
        async function(e, components, node_modules){
          const {${Object.keys(G).join()}} = node_modules;
          ${e}
        }
      )`)().bind(t==null?void 0:t.component)(t,se,G)}catch(n){console.error(n)}}const re=(e,t)=>({zIndex:t+1,left:`${e.x}px`,top:`${e.y}px`}),$e=(e,t)=>({width:`${t?t*e.w:e.w}px`,height:`${t?t*e.h:e.h}px`}),be=(e,t,n)=>e?{width:`${n?n*e.w:e.w}px`,height:`${n?n*e.h-t:e.h-t}px`}:{},ae=e=>({display:e.hide?"none":"block"}),ce=e=>{const t={};return e&&e.overFlowHidden&&(t.overflow="hidden"),t},Le=e=>{const t=e.selectColor?{background:e.background}:{background:`url(${e.backgroundImage}) center center / cover no-repeat !important`};return h({position:"relative",width:e.width?`${e.width||100}px`:"100%",height:e.height?`${e.height}px`:"100%"},t)};const ke=$({__name:"index",props:{groupData:{type:Object,required:!0},themeSetting:{type:Object,required:!0},themeColor:{type:Object,required:!0},groupIndex:{type:Number,required:!0}},setup(e){return(t,n)=>(p(!0),v(ee,null,j(e.groupData.groupList,s=>(p(),v("div",{class:P(["chart-item",a(K)(s.styles.animations)]),key:s.id,style:x(h(h(h(h(h(h({},a(re)(s.attr,e.groupIndex)),a(I)(s.styles)),a(X)(s.styles)),a(ae)(s.status)),a(ce)(s.preview)),a(Y)(s.styles)))},[(p(),C(Z(s.chartConfig.chartKey),J({id:s.id,chartConfig:s,themeSetting:e.themeSetting,themeColor:e.themeColor,style:h({},a($e)(s.attr))},Q(a(ie)(s))),null,16,["id","chartConfig","themeSetting","themeColor","style"]))],6))),128))}});var Te=W(ke,[["__scopeId","data-v-3933053a"]]);const Oe=$({__name:"index",setup(e){const t=y(!1),{initDataPond:n,clearMittDataPondMap:s}=Ce(),o=oe(),r=l=>{var w;return!!((w=l.chartConfig.filters)!=null&&w.length)},i=l=>{var u;const w=(u=l.chartConfig.filters)==null?void 0:u.map(f=>f.type==me.DATE&&f.from!="query"?221:450);if(!(w!=null&&w.length))return 0;const g=w==null?void 0:w.reduce((f,L)=>f+L+8),_=g?Math.ceil(g/l.attr.w):0;return _*24+(_-1)*8+16},c=F(()=>o.editCanvasConfig.chartThemeSetting),d=F(()=>{const l=o.editCanvasConfig.chartThemeColor;return ye[l]});return s(),te(()=>{n(o.requestGlobalConfig)}),(l,w)=>{const g=T("n-switch"),_=T("n-text"),N=T("n-space");return p(!0),v(ee,null,j(a(o).componentList,(u,f)=>(p(),v("div",{key:u.id,class:"chart-item",style:x(h(h(h(h(h(h({},a(re)(u.attr,f)),a(I)(u.styles)),a(X)(u.styles)),a(ae)(u.status)),a(ce)(u.preview)),a(Y)(u.styles)))},[r(u)?(p(),C(a(_e),{key:0,class:"filter-content",componentIdx:u.id,attr:u.attr,filters:u.chartConfig.filters,type:u.chartConfig.category},null,8,["componentIdx","attr","filters","type"])):E("",!0),u.chartConfig.key=="TableMergeCell"?(p(),C(N,{key:1},{default:A(()=>[z(g,{value:t.value,"onUpdate:value":w[0]||(w[0]=L=>t.value=L)},null,8,["value"]),z(_,null,{default:A(()=>[ve("\u624B\u52A8\u6EDA\u52A8")]),_:1})]),_:1})):E("",!0),ne("div",{class:P(a(K)(u.styles.animations))},[u.isGroup?(p(),C(a(Te),{key:0,groupData:u,groupIndex:f,themeSetting:a(c),themeColor:a(d)},null,8,["groupData","groupIndex","themeSetting","themeColor"])):(p(),C(Z(u.chartConfig.chartKey),J({key:1,id:u.id,chartConfig:u,themeSetting:a(c),themeColor:a(d),style:h({},a(be)(u.attr,i(u))),scrollMode:t.value?"manual":"auto"},Q(a(ie)(u))),null,16,["id","chartConfig","themeSetting","themeColor","style","scrollMode"]))],2)],4))),128)}}});var U=W(Oe,[["__scopeId","data-v-61576a4a"]]);const We=e=>{const t=y(!1),n=setInterval(()=>{if(window.$vue.component){clearInterval(n);const s=o=>{window.$vue.component(o.chartConfig.chartKey)||window.$vue.component(o.chartConfig.chartKey,Se(o.chartConfig))};e.componentList.forEach(o=>k(void 0,null,function*(){o.isGroup?o.groupList.forEach(r=>{s(r)}):s(o)})),t.value=!0}},200);return{show:t}},Pe=e=>{const t=y(),n=y(),s=y(e.editCanvasConfig.width),o=y(e.editCanvasConfig.height);return te(()=>{switch(e.editCanvasConfig.previewScaleType){case m.FIT:(()=>{const{calcRate:r,windowResize:i,unWindowResize:c}=Re(s.value,o.value,n.value);r(),i(),R(()=>{c()})})();break;case m.SCROLL_Y:(()=>{const{calcRate:r,windowResize:i,unWindowResize:c}=xe(s.value,o.value,n.value,d=>{const l=t.value;l.style.width=`${s.value*d.width}px`,l.style.height=`${o.value*d.height}px`});r(),i(),R(()=>{c()})})();break;case m.SCROLL_X:(()=>{const{calcRate:r,windowResize:i,unWindowResize:c}=Fe(s.value,o.value,n.value,d=>{const l=t.value;l.style.width=`${s.value*d.width}px`,l.style.height=`${o.value*d.height}px`});r(),i(),R(()=>{c()})})();break;case m.FULL:(()=>{const{calcRate:r,windowResize:i,unWindowResize:c}=Ee(s.value,o.value,n.value);r(),i(),R(()=>{c()})})();break}}),{entityRef:t,previewRef:n}},Ie=e=>{const t=oe();t.requestGlobalConfig=e[O.REQUEST_GLOBAL_CONFIG],t.editCanvasConfig=e[O.EDIT_CANVAS_CONFIG],t.componentList=e[O.COMPONENT_LIST]};const Ne=$({__name:"index",setup(e){let t=q();const n=F(()=>h(h({},Le(t.editCanvasConfig)),I(t.editCanvasConfig))),s=F(()=>{const c=t.editCanvasConfig.previewScaleType;return c===m.SCROLL_Y||c===m.SCROLL_X});Ie(t);const{entityRef:o,previewRef:r}=Pe(t),{show:i}=We(t);return(c,d)=>(p(),v("div",{class:P(`go-preview ${a(t).editCanvasConfig.previewScaleType}`)},[a(s)?(p(),v("div",{key:0,ref_key:"entityRef",ref:o,class:"go-preview-entity"},[ne("div",{ref_key:"previewRef",ref:r,class:"go-preview-scale"},[a(i)?(p(),v("div",{key:0,style:x(a(n))},[z(a(U))],4)):E("",!0)],512)],512)):(p(),v("div",{key:1,ref_key:"previewRef",ref:r,class:"go-preview-scale"},[a(i)?(p(),v("div",{key:0,style:x(a(n))},[z(a(U))],4)):E("",!0)],512))],2))}});var He=W(Ne,[["__scopeId","data-v-21ad7af6"]]);const qe=$({__name:"wrapper",setup(e){let t=y(Date.now());return[B.JSON,B.CHART].forEach(n=>{!window.opener||window.opener.addEventListener(n,s=>k(this,null,function*(){const o=yield q();ge(fe.GO_CHART_STORAGE_LIST,[M(h({},s.detail),{id:o.id})]),t.value=Date.now()}))}),(n,s)=>(p(),C(He,{key:a(t)}))}});export{qe as default};
