var de=Object.defineProperty,le=Object.defineProperties;var ue=Object.getOwnPropertyDescriptors;var H=Object.getOwnPropertySymbols;var he=Object.prototype.hasOwnProperty,we=Object.prototype.propertyIsEnumerable;var D=(e,t,n)=>t in e?de(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,h=(e,t)=>{for(var n in t||(t={}))he.call(t,n)&&D(e,n,t[n]);if(H)for(var n of H(t))we.call(t,n)&&D(e,n,t[n]);return e},M=(e,t)=>le(e,ue(t));var k=(e,t,n)=>new Promise((s,o)=>{var r=c=>{try{a(n.next(c))}catch(d){o(d)}},i=c=>{try{a(n.throw(c))}catch(d){o(d)}},a=c=>c.done?s(c.value):Promise.resolve(c.value).then(r,i);a((n=n.apply(e,t)).next())});import{g as q}from"./storage-6f275546.js";import{aG as S,bT as pe,d as $,h as v,A as j,F as K,o as p,ad as W,f as l,bU as X,aP as x,bV as P,bW as Y,bX as J,c as C,bY as Q,bZ as Z,L as ee,p as I,q as y,a5 as F,x as te,r as T,a9 as E,w as A,e as z,m as ve,z as ne,b_ as m,a6 as R,b$ as B,c0 as ge,S as fe}from"./index.js";import{t as b,u as oe,c as ye,d as _e,F as Ce,e as me,f as Se,C as O}from"./useSync.hook-a181ea44.js";import"./plugin-6aef7162.js";import"./icon-0e07ccce.js";import"./tables_list-38e71280.js";const Re=(e,t,n,s)=>{const o=e,r=t,i={width:1,height:1},a=parseFloat((o/r).toFixed(5)),c=()=>{const _=parseFloat((window.innerWidth/window.innerHeight).toFixed(5));n&&(_>a?(i.width=parseFloat((window.innerHeight*a/o).toFixed(5)),i.height=parseFloat((window.innerHeight/r).toFixed(5)),n.style.transform=`scale(${i.width}, ${i.height})`):(i.height=parseFloat((window.innerWidth/a/r).toFixed(5)),i.width=parseFloat((window.innerWidth/o).toFixed(5)),n.style.transform=`scale(${i.width}, ${i.height})`),s&&s(i))},d=b(()=>{c()},200);return{calcRate:c,windowResize:()=>{window.addEventListener("resize",d)},unWindowResize:()=>{window.removeEventListener("resize",d)}}},xe=(e,t,n,s)=>{const o=e,r=t,i={width:1,height:1},a=parseFloat((o/r).toFixed(5)),c=()=>{n&&(i.height=parseFloat((window.innerWidth/a/r).toFixed(5)),i.width=parseFloat((window.innerWidth/o).toFixed(5)),n.style.transform=`scale(${i.width}, ${i.height})`,s&&s(i))},d=b(()=>{c()},200);return{calcRate:c,windowResize:()=>{window.addEventListener("resize",d)},unWindowResize:()=>{window.removeEventListener("resize",d)}}},Fe=(e,t,n,s)=>{const o=e,r=t,i={height:1,width:1},a=parseFloat((o/r).toFixed(5)),c=()=>{n&&(i.width=parseFloat((window.innerHeight*a/o).toFixed(5)),i.height=parseFloat((window.innerHeight/r).toFixed(5)),n.style.transform=`scale(${i.width}, ${i.height})`,s&&s(i))},d=b(()=>{c()},200);return{calcRate:c,windowResize:()=>{window.addEventListener("resize",d)},unWindowResize:()=>{window.removeEventListener("resize",d)}}},Ee=(e,t,n,s)=>{const o={width:1,height:1},r=()=>{n&&(o.width=parseFloat((window.innerWidth/e).toFixed(5)),o.height=parseFloat((window.innerHeight/t).toFixed(5)),n.style.transform=`scale(${o.width}, ${o.height})`,s&&s(o))},i=b(()=>{r()},200);return{calcRate:r,windowResize:()=>{window.addEventListener("resize",i)},unWindowResize:()=>{window.removeEventListener("resize",i)}}},se={},G={echarts:pe},ie=e=>{if(!e.events)return{};const t={};for(const o in e.events.baseEvent){const r=e.events.baseEvent[o];r&&(t[o]=ze(r))}const n=e.events.advancedEvents||{},s={[S.VNODE_BEFORE_MOUNT](o){se[e.id]=o.component;const r=(n[S.VNODE_BEFORE_MOUNT]||"").trim();V(r,o)},[S.VNODE_MOUNTED](o){const r=(n[S.VNODE_MOUNTED]||"").trim();V(r,o)}};return h(h({},t),s)};function ze(e){try{return new Function(`
      return (
        async function(mouseEvent){
          ${e}
        }
      )`)()}catch(t){console.error(t)}}function V(e,t){try{Function(`
      "use strict";
      return (
        async function(e, components, node_modules){
          const {${Object.keys(G).join()}} = node_modules;
          ${e}
        }
      )`)().bind(t==null?void 0:t.component)(t,se,G)}catch(n){console.error(n)}}const re=(e,t)=>({zIndex:t+1,left:`${e.x}px`,top:`${e.y}px`}),$e=(e,t)=>({width:`${t?t*e.w:e.w}px`,height:`${t?t*e.h:e.h}px`}),be=(e,t,n)=>e?{width:`${n?n*e.w:e.w}px`,height:`${n?n*e.h-t:e.h-t}px`}:{},ae=e=>({display:e.hide?"none":"block"}),ce=e=>{const t={};return e&&e.overFlowHidden&&(t.overflow="hidden"),t},Le=e=>{const t=e.selectColor?{background:e.background}:{background:`url(${e.backgroundImage}) center center / cover no-repeat !important`};return h({position:"relative",width:e.width?`${e.width||100}px`:"100%",height:e.height?`${e.height}px`:"100%"},t)};const ke=$({__name:"index",props:{groupData:{type:Object,required:!0},themeSetting:{type:Object,required:!0},themeColor:{type:Object,required:!0},groupIndex:{type:Number,required:!0}},setup(e){return(t,n)=>(p(!0),v(K,null,j(e.groupData.groupList,s=>(p(),v("div",{class:W(["chart-item",l(X)(s.styles.animations)]),key:s.id,style:x(h(h(h(h(h(h({},l(re)(s.attr,e.groupIndex)),l(P)(s.styles)),l(Y)(s.styles)),l(ae)(s.status)),l(ce)(s.preview)),l(J)(s.styles)))},[(p(),C(ee(s.chartConfig.chartKey),Q({id:s.id,chartConfig:s,themeSetting:e.themeSetting,themeColor:e.themeColor,style:h({},l($e)(s.attr))},Z(l(ie)(s))),null,16,["id","chartConfig","themeSetting","themeColor","style"]))],6))),128))}});var Te=I(ke,[["__scopeId","data-v-3933053a"]]);const Oe=$({__name:"index",setup(e){const t=y(!1),{initDataPond:n,clearMittDataPondMap:s}=ye(),o=oe(),r=d=>{var w;return!!((w=d.chartConfig.filters)!=null&&w.length)},i=d=>{var u;const w=(u=d.chartConfig.filters)==null?void 0:u.map(f=>f.type==me.DATE&&f.from!="query"?221:450);if(!(w!=null&&w.length))return 0;const g=w==null?void 0:w.reduce((f,L)=>f+L+8),_=g?Math.ceil(g/d.attr.w):0;return _*24+(_-1)*8+16},a=F(()=>o.editCanvasConfig.chartThemeSetting),c=F(()=>{const d=o.editCanvasConfig.chartThemeColor;return _e[d]});return s(),te(()=>{n(o.requestGlobalConfig)}),(d,w)=>{const g=T("n-switch"),_=T("n-text"),N=T("n-space");return p(!0),v(K,null,j(l(o).componentList,(u,f)=>(p(),v("div",{key:u.id,class:"chart-item",style:x(h(h(h(h(h(h({},l(re)(u.attr,f)),l(P)(u.styles)),l(Y)(u.styles)),l(ae)(u.status)),l(ce)(u.preview)),l(J)(u.styles)))},[r(u)?(p(),C(l(Ce),{key:0,class:"filter-content",componentIdx:u.id,attr:u.attr,filters:u.chartConfig.filters,type:u.chartConfig.category},null,8,["componentIdx","attr","filters","type"])):E("",!0),u.chartConfig.key=="TableMergeCell"?(p(),C(N,{key:1},{default:A(()=>[z(g,{value:t.value,"onUpdate:value":w[0]||(w[0]=L=>t.value=L)},null,8,["value"]),z(_,null,{default:A(()=>[ve("\u624B\u52A8\u6EDA\u52A8")]),_:1})]),_:1})):E("",!0),ne("div",{class:W(l(X)(u.styles.animations))},[u.isGroup?(p(),C(l(Te),{key:0,groupData:u,groupIndex:f,themeSetting:a.value,themeColor:c.value},null,8,["groupData","groupIndex","themeSetting","themeColor"])):(p(),C(ee(u.chartConfig.chartKey),Q({key:1,id:u.id,chartConfig:u,themeSetting:a.value,themeColor:c.value,style:h({},l(be)(u.attr,i(u))),scrollMode:t.value?"manual":"auto"},Z(l(ie)(u))),null,16,["id","chartConfig","themeSetting","themeColor","style","scrollMode"]))],2)],4))),128)}}});var U=I(Oe,[["__scopeId","data-v-61576a4a"]]);const We=e=>{const t=y(!1),n=setInterval(()=>{if(window.$vue.component){clearInterval(n);const s=o=>{window.$vue.component(o.chartConfig.chartKey)||window.$vue.component(o.chartConfig.chartKey,Se(o.chartConfig))};e.componentList.forEach(o=>k(void 0,null,function*(){o.isGroup?o.groupList.forEach(r=>{s(r)}):s(o)})),t.value=!0}},200);return{show:t}},Pe=e=>{const t=y(),n=y(),s=y(e.editCanvasConfig.width),o=y(e.editCanvasConfig.height);return te(()=>{switch(e.editCanvasConfig.previewScaleType){case m.FIT:(()=>{const{calcRate:r,windowResize:i,unWindowResize:a}=Re(s.value,o.value,n.value);r(),i(),R(()=>{a()})})();break;case m.SCROLL_Y:(()=>{const{calcRate:r,windowResize:i,unWindowResize:a}=xe(s.value,o.value,n.value,c=>{const d=t.value;d.style.width=`${s.value*c.width}px`,d.style.height=`${o.value*c.height}px`});r(),i(),R(()=>{a()})})();break;case m.SCROLL_X:(()=>{const{calcRate:r,windowResize:i,unWindowResize:a}=Fe(s.value,o.value,n.value,c=>{const d=t.value;d.style.width=`${s.value*c.width}px`,d.style.height=`${o.value*c.height}px`});r(),i(),R(()=>{a()})})();break;case m.FULL:(()=>{const{calcRate:r,windowResize:i,unWindowResize:a}=Ee(s.value,o.value,n.value);r(),i(),R(()=>{a()})})();break}}),{entityRef:t,previewRef:n}},Ie=e=>{const t=oe();t.requestGlobalConfig=e[O.REQUEST_GLOBAL_CONFIG],t.editCanvasConfig=e[O.EDIT_CANVAS_CONFIG],t.componentList=e[O.COMPONENT_LIST]};const Ne=$({__name:"index",setup(e){let t=q();const n=F(()=>h(h({},Le(t.editCanvasConfig)),P(t.editCanvasConfig))),s=F(()=>{const a=t.editCanvasConfig.previewScaleType;return a===m.SCROLL_Y||a===m.SCROLL_X});Ie(t);const{entityRef:o,previewRef:r}=Pe(t),{show:i}=We(t);return(a,c)=>(p(),v("div",{class:W(`go-preview ${l(t).editCanvasConfig.previewScaleType}`)},[s.value?(p(),v("div",{key:0,ref_key:"entityRef",ref:o,class:"go-preview-entity"},[ne("div",{ref_key:"previewRef",ref:r,class:"go-preview-scale"},[l(i)?(p(),v("div",{key:0,style:x(n.value)},[z(l(U))],4)):E("",!0)],512)],512)):(p(),v("div",{key:1,ref_key:"previewRef",ref:r,class:"go-preview-scale"},[l(i)?(p(),v("div",{key:0,style:x(n.value)},[z(l(U))],4)):E("",!0)],512))],2))}});var He=I(Ne,[["__scopeId","data-v-21ad7af6"]]);const qe=$({__name:"wrapper",setup(e){let t=y(Date.now());return[B.JSON,B.CHART].forEach(n=>{!window.opener||window.opener.addEventListener(n,s=>k(this,null,function*(){const o=yield q();ge(fe.GO_CHART_STORAGE_LIST,[M(h({},s.detail),{id:o.id})]),t.value=Date.now()}))}),(n,s)=>(p(),C(He,{key:l(t)}))}});export{qe as default};
